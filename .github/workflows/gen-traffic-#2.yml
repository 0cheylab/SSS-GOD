on:
  schedule:
    - cron: "*/1 * * * *" # ทำงานทุก 1 นาที

jobs:
  gen-traffic:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Generate traffic
        env:
          HOST: ${{ secrets.HOST }}
        run: |
          urls=$(cat urls.txt)
          while true; do
            while read -r -d '' -u 9 url; do
              echo "Making request to ${url}"
              curl -o /dev/null "$url"
              sleep 1
            done 9< <(find urls.txt -maxdepth 1 -type f -print0 | xargs -0 cat | head -n 20)

            sleep 5
          done
